# Advanced Security IP Blocker

![Version](https://img.shields.io/badge/Version-2.5-blue.svg)
![Author](https://img.shields.io/badge/Author-Robert%20Bennett-lightgrey.svg)
![License](https://img.shields.io/badge/License-GPLv2%2B-green.svg)
![WordPress](https://img.shields.io/badge/WordPress-5.0%2B-blue.svg)

Комплексная система безопасности для WordPress: блокировка IP-адресов, защита `wp-login.php` и `xmlrpc.php`, блокировка опасных файлов и ботов с поддержкой ASN.

## Описание

Плагин **Advanced Security IP Blocker** предоставляет мощные инструменты для защиты вашего сайта WordPress от различных угроз. Он использует правила `.htaccess` для эффективной блокировки нежелательного трафика, обеспечивая высокий уровень безопасности и производительности.

### Основные возможности:

*   **Блокировка IP-адресов:** Блокируйте отдельные IP-адреса, диапазоны CIDR и целые автономные системы (ASN).
*   **Защита `wp-login.php` и `xmlrpc.php`:** Ограничьте доступ к этим критически важным файлам, разрешая его только доверенным IP-адресам или ASN.
*   **Блокировка опасных файлов:** Защитите конфиденциальные файлы (например, `.htaccess`, `wp-config.php`, логи) от прямого доступа.
*   **Защита от ботов:** Блокируйте вредоносных ботов и сканеров по их User-Agent строкам.
*   **Поддержка ASN:** Автоматическое преобразование номеров автономных систем (ASN) в списки IP-диапазонов для блокировки или разрешения.
*   **Резервное копирование `.htaccess`:** Автоматическое создание резервных копий файла `.htaccess` перед внесением изменений.
*   **Кэширование ASN:** Кэширование данных ASN для ускорения работы и снижения нагрузки на внешние API.
*   **Удобный интерфейс:** Интуитивно понятная панель администратора с вкладками для управления всеми функциями.

## Установка

1.  **Загрузка:** Загрузите файлы плагина в директорию `/wp-content/plugins/advanced-security-ip-blocker` или установите плагин через стандартный установщик плагинов WordPress.
2.  **Активация:** Активируйте плагин через меню "Плагины" в вашей админ-панели WordPress.
3.  **Настройка:** Перейдите в `Настройки -> Безопасность` для настройки параметров плагина.

## Использование

После активации плагина вы найдете новую страницу настроек в разделе `Настройки -> Безопасность`. Эта страница разделена на несколько вкладок, каждая из которых отвечает за определенный аспект безопасности.

### 1. Блокировка IP

На этой вкладке вы можете указать IP-адреса, диапазоны CIDR или ASN, которые будут заблокированы.

*   **Форматы ввода:**
    *   Одиночный IP: `192.168.1.100`
    *   CIDR диапазон: `192.168.1.0/24`
    *   ASN (автономная система): `AS15169` или `15169` (например, для Google)
*   Каждая запись должна быть на новой строке.
*   Плагин автоматически преобразует ASN в соответствующие IP-диапазоны и добавляет их в `.htaccess`.

### 2. Защита wp-login.php и xmlrpc.php

Эта вкладка позволяет ограничить доступ к страницам входа и XML-RPC интерфейсу, разрешая его только с указанных IP-адресов.

*   **Важно:** Обязательно добавьте свой текущий IP-адрес в белый список, иначе вы не сможете войти в админ-панель после активации защиты! Ваш текущий IP отображается на странице настроек.
*   **Выберите файлы для защиты:** Отметьте чекбоксы для `wp-login.php` и/или `xmlrpc.php`.
*   **Разрешенные IP:** Введите IP-адреса, диапазоны CIDR, ASN, маски подсети или частичные IP-адреса, которым будет разрешен доступ.
    *   Одиночный IP: `192.168.1.100`
    *   CIDR диапазон: `192.168.1.0/24`
    *   ASN: `AS15169`
    *   Маска подсети: `192.168.1.0 255.255.255.0`
    *   Частичный IP: `192.168.1` (разрешит `192.168.1.x`)
*   Используйте кнопку "Добавить мой IP", чтобы быстро добавить свой текущий IP-адрес в список.

### 3. Блокировка файлов

Здесь вы можете указать имена файлов или маски, доступ к которым будет заблокирован.

*   Каждая запись должна быть на новой строке.
*   Поддерживаются маски с символом `*`, например:
    *   `*.log` (заблокирует все файлы с расширением `.log`)
    *   `*.bak` (заблокирует все файлы с расширением `.bak`)
    *   `.htaccess`
    *   `wp-config.php`

### 4. Защита от ботов

На этой вкладке вы можете ввести список User-Agent строк, разделенных символом `|`, которые будут заблокированы.

*   Пример: `BadBot|SpamBot|Crawler`
*   Поддерживается частичное совпадение.
*   Плагин использует директивы `SetEnvIfNoCase` и `Deny from env` в `.htaccess` для блокировки запросов с указанными User-Agent.

### 5. Статус системы

Эта вкладка предоставляет обзор текущего состояния плагина и важную системную информацию:

*   **Системная информация:**
    *   Доступность `.htaccess` для записи.
    *   Статус директорий для резервных копий и кэша ASN.
    *   Дата последней резервной копии.
    *   Количество кэшированных ASN.
    *   Ваш текущий IP-адрес.
*   **Активные защиты:** Показывает, какие функции защиты активны и сколько правил применено.
*   **Действия:**
    *   **Создать резервную копию .htaccess:** Рекомендуется делать это перед внесением значительных изменений.
    *   **Очистить кэш ASN:** Удаляет все кэшированные данные ASN, что может быть полезно, если диапазоны ASN изменились.

## Резервное копирование и восстановление

Плагин автоматически создает резервные копии вашего файла `.htaccess` в директории `wp-content/security-blocker-backups/` перед каждым изменением. Хранится до 10 последних резервных копий. В случае ошибки или проблем с доступом, плагин попытается восстановить предыдущую рабочую версию `.htaccess`.

## Журнал операций

После каждой операции (сохранение настроек, создание резервной копии и т.д.) плагин выводит журнал операций, который содержит информацию о выполненных действиях и возможных ошибках. Это помогает отслеживать изменения и диагностировать проблемы.

## Часто задаваемые вопросы

### Q: Что делать, если я заблокировал себя?

**A:** Если вы заблокировали свой IP-адрес и не можете войти в админ-панель, вам потребуется вручную отредактировать файл `.htaccess` через FTP или файловый менеджер хостинга. Удалите или закомментируйте правила, добавленные плагином, которые находятся между маркерами `# LOGIN_PROTECTION_MARKER`.

### Q: Почему мой IP-адрес постоянно меняется?

**A:** Некоторые интернет-провайдеры назначают динамические IP-адреса. Если ваш IP часто меняется, рассмотрите возможность использования диапазона CIDR, если ваш провайдер использует стабильный диапазон, или используйте VPN со статическим IP. В крайнем случае, вы можете временно отключить защиту `wp-login.php` и `xmlrpc.php`, если это вызывает постоянные проблемы с доступом.

### Q: Как работает блокировка по ASN?

**A:** Когда вы вводите ASN (например, `AS15169`), плагин обращается к внешним API (например, RIPE NCC, HackerTarget) для получения всех IP-диапазонов, связанных с этим ASN. Затем эти диапазоны добавляются в `.htaccess` для блокировки или разрешения. Данные ASN кэшируются на 24 часа для повышения производительности.

### Q: Могу ли я использовать этот плагин с другими плагинами безопасности?

**A:** В большинстве случаев да. Однако, поскольку этот плагин активно модифицирует `.htaccess`, могут возникнуть конфликты с другими плагинами, которые также сильно изменяют этот файл. Рекомендуется протестировать плагин в тестовой среде перед использованием на рабочем сайте.

### Q: Что произойдет при деактивации плагина?

**A:** При деактивации плагин автоматически удаляет все правила, которые он добавил в `.htaccess`, возвращая файл в исходное состояние (до установки плагина). Это обеспечивает чистое удаление без оставления следов.

## Разработка

Плагин разработан Робертом Беннеттом.
Исходный код доступен на GitHub: [https://github.com/RobertoBennett/IP-Blocker-Manager](https://github.com/RobertoBennett/IP-Blocker-Manager)

## Лицензия

Этот плагин распространяется под лицензией GPLv2 или более поздней версии.

---
